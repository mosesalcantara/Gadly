<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  {% load static %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <link rel="apple-touch-icon" sizes="76x76" href="{% static 'img/apple-icon.png' %}">
  <link rel="icon" type="image/png" href="{% static 'img/favicon.png' %}">
  <title>Gadly</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
  <!-- Nucleo Icons -->
  <link href="{% static 'css/nucleo-icons.css' %}" rel="stylesheet" /> 
  <link href="{% static 'css/nucleo-svg.css' %}" rel="stylesheet" />
  <!-- Font Awesome Icons -->
  <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
  <link href="{% static 'css/nucleo-svg.css' %}" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" rel="stylesheet" />
  <!-- CSS Files -->
  <link id="pagestyle" href="{% static 'css/argon-dashboard.css' %}" rel="stylesheet" /> 
  <style>
    #myProgress {
      width: 100%;
      background-color: #ddd;
    }
    #myBar {
      width: 1%;
      height: 30px;
      background-color: #04AA6D;
    }
    .glass {
      background-color: rgba(255, 255, 255, 0.45);
      backdrop-filter: blur(15px);
      box-shadow: 0 0 10px 1px rgb(0 0 0 / 25%);
    }
    .glass-sidebar{
      background-color: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(15px);
      border-radius: 15px;
      box-shadow: 0 0 10px 1px rgb(0 0 0 / 25%);
    }
    .theme-color {
      background-image: linear-gradient(#CB5CBA, #824AB5);
    }
    .msgs-con{
      display:flex;
      justify-content: center;
      align-items: center;
      height:17%;
      width: 100%;
    }
    .msgs{
      width:10%;
    }
    .info{
      background-color: #D9EDF9;
      color: rgb(12, 59, 51);
      box-shadow: 0 0 10px 1px rgb(0 0 0 / 25%);
    }
    .btn-close{
      color: black;
    }
  </style>
</head>

<body class="g-sidenav-show   bg-gray-100">
  {% include './includes/sidebar.html' %}
  <main class="main-content position-relative border-radius-lg ">
    <!-- Navbar -->
    {% include './includes/navbar.html' %}
    <div class="msgs-con">
      <div id='alert' class="alert info alert-dismissible fade show msgs" role="alert" style="display: none;">
        <span id="alert_percent">percent</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="color: rgb(12, 59, 51);">
          &times;
        </button>
      </div>
    </div>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
      <!---->
      <div class="row">
        <div class="col-lg-12 mb-lg-0">
          <div class="card z-index-2 glass">
            <div class="card-header pb-0 pt-3 bg-transparent">
              <h6 class="text-capitalize">Type Your Phrase Here</h6>
              <form action="/backend/upl_file/" style="display: none;" id="upl_form" enctype="multipart/form-data">
                <input type="file" id="file" name="file">
              </form>
              <p>
                <i class="fa-solid fa-microphone" onclick="runSpeechRecognition()" style="cursor: pointer;" title="Speech Recognition"></i><span id="action"></span>
                <i class="fa-solid fa-file-arrow-up" aria-hidden="true" title="Upload File" id="upl_open" style="cursor: pointer;"></i>
                <i class="fa-regular fa-clipboard" onclick="copy_text()" style="cursor: pointer;" title="Copy to Clipboard"></i><span id="copied">
              </p>
              <!-- <p><i class="fa-solid fa-microphone" onclick="runSpeechRecognition()" style="cursor: pointer;" title="Speech Recognition"></i><span id="action"></span></p> -->
              <button class="btn btn-primary d-flex align-items-center" id="checkPlag">
                <span class="spinner-border spinner-border-sm text-info mr-2 p-r-4" role="status" id = "spinner" style = "display: none;"></span>
                <span class="ml-auto" id = "Check_Plagiarism">Check Plagiarism</span>
                <!-- <span class="ml-auto">Check Plagiarism</span> -->
              </button>
              
            </div>
            <div class="card-body p-3" style="overflow:auto;height:50vh;" contenteditable="true" id="input">
            </div>
            <div id="myProgress" style="display: none;">
              <div id="myBar"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-xl-3 col-sm-6 mb-xl-0">
          <div class="card glass">
            <div class="card-body p-3">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Plagiarism</p>
                    <h5 class="font-weight-bolder" id="percent"></h5>
                    <p class="mb-0">
                      <span class="text-danger text-sm font-weight-bolder"></span>
                    </p>
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% include './includes/footer.html' %} 
    </div>
  </main>
  {% include './includes/settings.html' %} 
  <!--   Core JS Files   -->
  <script src="{% static 'js/core/popper.min.js' %}"></script>
  <script src="{% static 'js/core/bootstrap.min.js' %}"></script>
  <script src="{% static 'js/plugins/perfect-scrollbar.min.js' %}"></script>
  <script src="{% static 'js/plugins/smooth-scrollbar.min.js' %}"></script>
  <script src="{% static 'js/plugins/chartjs.min.js' %}"></script>
  
  <script>
    function runSpeechRecognition() {
      var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition
      var recognition = new SpeechRecognition()
  
      recognition.onstart = function() {
        $('#action').html(" <small>listening, please speak...</small>")
      };
      
      recognition.onspeechend = function() {
        $('#action').html(" <small>stopped listening, hope you are done...</small>")
        setTimeout(() => {
          $('#action').html('')
        }, 3000)
        recognition.stop()
      }
    
      recognition.onresult = function(event) {
        var transcript = event.results[0][0].transcript
        $('#input').html(transcript)
      };
    
      recognition.start();
    }

    $("#upl_open").click(function(event){
        $('#file').trigger('click');
      })

      document.getElementById("file").onchange = function() {
        $("#upl_form").submit()
      };

      $("#upl_form").on('submit', function(e){
        e.preventDefault();
        $.ajax({
          type: 'POST',
          url: '/backend/upl_file/',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}'
          },
          data: new FormData(this),
          dataType: 'json',
          contentType: false,
          cache: false,
          processData:false,
          success: function(res){
            var txt = res.txt
            $('#input').empty()
            $('#input').html(txt)
            // check_wordcount()
          }
        })
      })

    
    $(document).ready(function() {  
      var b = document.getElementById("myBar");
      b.style.width = 0 + "%"
      // perc = 0
      $("#checkPlag").click(function(event){
        $("#spinner").attr("style", "block")
        $('#percent').empty()
        var txt = $("#input").text()
        var bar = document.getElementById("myBar");
        bar.style.width = 0 + "%"

        $.ajax( {
          method:"POST",
          url:'/backend/check_plag/',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}'
          },
          data:{
            txt:txt
          },
          success:function(data) {
            $("#spinner").attr("style", "display:none")
            var i = 0;
            if (i == 0) {
              i = 1;
              var elem = document.getElementById("myBar");
              var width = 1;
              var id = setInterval(frame, 10);
              var percent = data.percent
              // console.log(percent)
              $('#percent').html(percent+'%')
              $('#alert_percent').html(percent+'%')
              $('#alert').css('display', 'block')
              
              function frame() {
                if (width >= 100) {

                  clearInterval(id);
                  i = 0;
                } else {
                  width = width+10;
                  elem.style.width = width + "%";
                }
              }
            }
          }
        })
      })
    })

    function copy_text(){
      var txt = $('#input').text()
      // console.log(output)
      navigator.clipboard.writeText(txt)
      $('#copied').text(' Copied')
      setTimeout(() => {
        $('#copied').text('')
      }, 3000)
    }
  </script>
  <!-- Github buttons -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
  
  <script src="{% static 'js/argon-dashboard.min.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
</body>
</html>
