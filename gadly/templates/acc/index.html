<!DOCTYPE html>
<html lang="es" dir="ltr">
  <head>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
    <meta charset="utf-8">
    {% load static %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{% static 'css/account.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="icon" type="image" href="{% static 'img/favicon.png' %}">
    <title>Sign In</title>
    <style>
      .acc-msg-con{
        display:flex;
        position: absolute;
        justify-content: center;
        align-items: center;
        top:0;
        height:17%;
        width: 52.3%;
        z-index: 999;
        pointer-events: none;
      }
      .acc-msg-alert{
        width:auto;
        font-weight: bold;
      }
      .form-control{
        width: 17vw;
        margin: 0.15vw 0;
        font-size: 1rem;
        letter-spacing: 0.15px;
        font-family: "Montserrat", sans-serif;
        background-color: #ecf0f3;
        transition: 0.25s ease;
        border-radius: 8px;
        box-shadow: inset 2px 2px 4px #d1d9e6, inset -2px -2px 4px #f9f9f9;
        border: none;
        outline: none;
      }
      label {
        color:black;
        font-size: 15px;
      }
      .btn-close{
        color: black;
        pointer-events: all;
      }
    </style>
  </head>
  <body>
    <div class="acc-msgs-con">
      {% include './includes/msgs.html' %}
    </div>
    <div class="main">
      <div class="container a-container" id="a-container">
        <div class="row">
          <div class="col">
            <form class="form" id="a-form" action="/acc/login/" method="post">
              {% csrf_token %}
              <h2 class="form_title title">Sign in to Gadly</h2>
              <div class="form-floating mb-1">
                {{ logform.uname }}
                <label>Username</label>
              </div>
              <div class="form-floating mb-1">
                {{ logform.pswd }}
                <label>Password</label>
              </div>
              <a class="form__link" style="text-decoration: none;" href="/acc/reset">Forgot your password?</a>
              <button class="form__button button d-inline-flex align-items-center justify-content-center" name="log" type="submit">
                <span role="status">LOGIN</span>
              </button>
            </form>
          </div>
        </div>
      </div>
      <div class="container b-container" id="b-container">
        <div class="row">
          <div class="col">
            <form class="form" id="b-form" action="/acc/register/" method="post">
              {% csrf_token %}
              <h2 class="form_title title">Create Account</h2>
              <div class="row">
                <div class="col">
                  <div class="form-floating mb-1">
                    {{ regform.name }}
                    <label>Fullname</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="form-floating mb-1">
                    {{ regform.phone }}
                    <label>Phone Number</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-floating mb-1">
                    {{ regform.email }}
                    <label>Email</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="form-floating mb-1">
                    {{ regform.uname }}
                    <label>Username</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  <div class="form-floating mb-1">
                    {{ regform.pswd }}
                    <label>Password</label>
                  </div>
                </div>
                <div class="col">
                  <div class="form-floating mb-1">
                    {{ regform.con_pswd }}
                    <label>Confirm Password</label>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col">
                  {{ regform.utype }}
                </div>
              </div>
              <button class="form__button button d-inline-flex align-items-center justify-content-center" name="reg" type="submit">
                <span class="spinner-border spinner-border-sm text-info" id="register_spinner" style ="display:none;"></span>
                <span role="status">REGISTER</span>
              </button>
            </form>
          </div>
        </div>
      </div>
      <div class="switch" id="switch-cnt">
        <div class="switch__circle"></div>
        <div class="switch__circle switch__circle--t"></div>
        <div class="switch__container" id="switch-c1">
          <h2 class="switch__title title">Hello Friend !</h2>
          <p class="switch__description description">Enter your information and start journey with us</p>
          <button class="switch__button button switch-btn">REGISTER</button>
        </div>
        <div class="switch__container is-hidden" id="switch-c2">
          <h2 class="switch__title title">Welcome Back !</h2>
          <p class="switch__description description">To keep connected with us please login with your personal info</p>
          <button class="switch__button button switch-btn">LOGIN</button>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="{% static 'js/main.js' %}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script>
      $(document).ready(function() {  

        function display_msgs(e,res) {
          var code = res.code
          var msgs = res.msgs
          var ele = e.target.id.charAt(0)
          
          var msgs_con = $(`.acc-msgs-con`)
          if (code == 200) {
            var msg_tag = 'alert-success'
            $(`#${ele}-form`).trigger('reset')
          }
          else {
            var msg_tag = 'alert-danger'
          }

          var msg_con = $('<div>').addClass('acc-msg-con')
          msgs_con.append(msg_con)

          var msg_alert= $('<div>').addClass(`alert ${msg_tag} alert-dismissible fade show acc-msg-alert`)
          msg_alert.attr('role', 'alert')
          msg_alert.text(msgs[0])
          msg_con.append(msg_alert)

          var close_btn = $('<button>').addClass('btn-close')
          close_btn.attr({
            'type' : 'button',
            'data-bs-dismiss' : "alert", 
            'aria-label' : "Close",
          })
          close_btn.html('&times;')
          msg_alert.append(close_btn)
        }

        $('#a-form').submit(function(e) {
          e.preventDefault()
          var data = $(this).serialize()

          $.ajax({
            type: 'POST',
            url: "/acc/login/",
            data: data,
            success: function (res) {
              if (res.code == 200) {
                if (res.msgs[0] == 'admin') {
                  window.location.replace('/admin/')
                } 
                else {
                  window.location.replace('/user/')
                }
              }
              else {
                display_msgs(e,res)
              }
            },
            error: function (res) {

            },
          })    
        })

        $('#b-form').submit(function(e) {
          $("#register_spinner").attr("style", "display:inline")
          e.preventDefault()
          var data = $(this).serialize()

          $.ajax({
            type: 'POST',
            url: "/acc/register/",
            data: data,
            success: function (res) {
              $("#register_spinner").attr("style", "display:none")
              display_msgs(e,res)
            },
            error: function (res) {

            },
          })    
        })

      })
    </script>
  </body>
</html>